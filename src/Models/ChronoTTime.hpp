//  ChronoTTime.hpp :: Tick-based time point model
//  Copyright 2011 - 2014 Chu Chin Kuan <keigen.shu@gmail.com>

#ifndef MODEL_CHRONO_TTIME_H
#define MODEL_CHRONO_TTIME_H

#include <utility>


struct TTime
{
	unsigned int t; //!< Tick
	unsigned int b; //!< Beat
	unsigned int m; //!< Measure

	constexpr TTime(unsigned int tick = 0, unsigned int beat = 0, unsigned int measure = 0)
		: t(tick), b(beat), m(measure) { }

	bool operator== (const TTime &other) const;
	bool operator>= (const TTime &other) const;
	bool operator<= (const TTime &other) const;
	bool operator> (const TTime &other) const;
	bool operator< (const TTime &other) const;

	inline void reset() { t = b = m = 0; }
};


using beat_count_t = unsigned short; //!< Measure size type for storing the number of beats in measure.
using tick_count_t = unsigned short; //!< Beat size type for storing the number of precise ticks per beat.
using tick_delta_t = int; //!< Tick delta arithmetic type

//! Measure time signature. The first parameter is the beat count
using TSignature = std::pair<beat_count_t, tick_count_t>;

//! Calculates the number of ticks for this time signature.
constexpr tick_count_t getTickCount(const TSignature &s)
{
    return s.first * s.second;
}

//! Wraps a tick count to the time signature.
constexpr TTime wrap(const TSignature &s, const tick_count_t c)
{
    return TTime (
        c % s.second
        , (c / s.second) % s.first
        , (c / s.second) / s.first
        );
}


//! Obtains the time signature based on normal measure size ratio.
TSignature getTimeSignature(double z);

//! Time signature ratio lookup table
constexpr std::pair< double, TSignature > kTimeSignatureLookup[] = {

    {  0.25    , { 1, 48} },{  0.5     , { 2, 48} },{  0.75    , { 3, 48} },{  1.0     , { 4, 48} },
    {  1.25    , { 5, 48} },{  1.5     , { 6, 48} },{  1.75    , { 7, 48} },{  2.0     , { 8, 48} },
    {  2.25    , { 9, 48} },{  2.5     , {10, 48} },{  2.75    , {11, 48} },{  3.0     , {12, 48} },
    {  3.25    , {13, 48} },{  3.5     , {14, 48} },{  3.75    , {15, 48} },{  4.0     , {16, 48} },
    {  4.25    , {17, 48} },{  4.5     , {18, 48} },{  4.75    , {19, 48} },{  5.0     , {20, 48} },
    {  5.25    , {21, 48} },{  5.5     , {22, 48} },{  5.75    , {23, 48} },{  6.0     , {24, 48} },
    {  6.25    , {25, 48} },{  6.5     , {26, 48} },{  6.75    , {27, 48} },{  7.0     , {28, 48} },
    {  7.25    , {29, 48} },{  7.5     , {30, 48} },{  7.75    , {31, 48} },{  8.0     , {32, 48} },

    {  8.25    , {33, 48} },{  8.5     , {34, 48} },{  8.75    , {35, 48} },{  9.0     , {36, 48} },
    {  9.25    , {37, 48} },{  9.5     , {38, 48} },{  9.75    , {39, 48} },{ 10.0     , {40, 48} },
    { 10.25    , {41, 48} },{ 10.5     , {42, 48} },{ 10.75    , {43, 48} },{ 11.0     , {44, 48} },
    { 11.25    , {45, 48} },{ 11.5     , {46, 48} },{ 11.75    , {47, 48} },{ 12.0     , {48, 48} },
    { 12.25    , {49, 48} },{ 12.5     , {50, 48} },{ 12.75    , {51, 48} },{ 13.0     , {52, 48} },
    { 13.25    , {53, 48} },{ 13.5     , {54, 48} },{ 13.75    , {55, 48} },{ 14.0     , {56, 48} },
    { 14.25    , {57, 48} },{ 14.5     , {58, 48} },{ 14.75    , {59, 48} },{ 15.0     , {60, 48} },
    { 15.25    , {61, 48} },{ 15.5     , {62, 48} },{ 15.75    , {63, 48} },{ 16.0     , {64, 48} },

    {  0.125   , { 1, 24} },{  0.375   , { 3, 24} },{  0.625   , { 5, 24} },{  0.875   , { 7, 24} },
    {  1.125   , { 9, 24} },{  1.375   , {11, 24} },{  1.625   , {13, 24} },{  1.875   , {15, 24} },
    {  2.125   , {17, 24} },{  2.375   , {19, 24} },{  2.625   , {21, 24} },{  2.875   , {23, 24} },
    {  3.125   , {25, 24} },{  3.375   , {27, 24} },{  3.625   , {29, 24} },{  3.875   , {31, 24} },
    {  4.125   , {33, 24} },{  4.375   , {35, 24} },{  4.625   , {37, 24} },{  4.875   , {39, 24} },
    {  5.125   , {41, 24} },{  5.375   , {43, 24} },{  5.625   , {45, 24} },{  5.875   , {47, 24} },
    {  6.125   , {49, 24} },{  6.375   , {51, 24} },{  6.625   , {53, 24} },{  6.875   , {55, 24} },
    {  7.125   , {57, 24} },{  7.375   , {59, 24} },{  7.625   , {61, 24} },{  7.875   , {63, 24} },

    {  0.0625  , { 1, 12} },{  0.1875  , { 3, 12} },{  0.3125  , { 5, 12} },{  0.4375  , { 7, 12} },
    {  0.5625  , { 9, 12} },{  0.6875  , {11, 12} },{  0.8125  , {13, 12} },{  0.9375  , {15, 12} },
    {  1.0625  , {17, 12} },{  1.1875  , {19, 12} },{  1.3125  , {21, 12} },{  1.4375  , {23, 12} },
    {  1.5625  , {25, 12} },{  1.6875  , {27, 12} },{  1.8125  , {29, 12} },{  1.9375  , {31, 12} },
    {  2.0625  , {33, 12} },{  2.1875  , {35, 12} },{  2.3125  , {37, 12} },{  2.4375  , {39, 12} },
    {  2.5625  , {41, 12} },{  2.6875  , {43, 12} },{  2.8125  , {45, 12} },{  2.9375  , {47, 12} },
    {  3.0625  , {49, 12} },{  3.1875  , {51, 12} },{  3.3125  , {53, 12} },{  3.4375  , {55, 12} },
    {  3.5625  , {57, 12} },{  3.6875  , {59, 12} },{  3.8125  , {61, 12} },{  3.9375  , {63, 12} },

    {  0.03125 , { 1,  6} },{  0.09375 , { 3,  6} },{  0.15625 , { 5,  6} },{  0.21875 , { 7,  6} },
    {  0.28125 , { 9,  6} },{  0.34375 , {11,  6} },{  0.40625 , {13,  6} },{  0.46875 , {15,  6} },
    {  0.53125 , {17,  6} },{  0.59375 , {19,  6} },{  0.65625 , {21,  6} },{  0.71875 , {23,  6} },
    {  0.78125 , {25,  6} },{  0.84375 , {27,  6} },{  0.90625 , {29,  6} },{  0.96875 , {31,  6} },
    {  1.03125 , {33,  6} },{  1.09375 , {35,  6} },{  1.15625 , {37,  6} },{  1.21875 , {39,  6} },
    {  1.28125 , {41,  6} },{  1.34375 , {43,  6} },{  1.40625 , {45,  6} },{  1.46875 , {47,  6} },
    {  1.53125 , {49,  6} },{  1.59375 , {51,  6} },{  1.65625 , {53,  6} },{  1.71875 , {55,  6} },
    {  1.78125 , {57,  6} },{  1.84375 , {59,  6} },{  1.90625 , {61,  6} },{  1.96875 , {63,  6} },

    {  0.015625, { 1,  3} },{  0.046875, { 3,  3} },{  0.078125, { 5,  3} },{  0.109375, { 7,  3} },
    {  0.140625, { 9,  3} },{  0.171875, {11,  3} },{  0.203125, {13,  3} },{  0.234375, {15,  3} },
    {  0.265625, {17,  3} },{  0.296875, {19,  3} },{  0.328125, {21,  3} },{  0.359375, {23,  3} },
    {  0.390625, {25,  3} },{  0.421875, {27,  3} },{  0.453125, {29,  3} },{  0.484375, {31,  3} },
    {  0.515625, {33,  3} },{  0.546875, {35,  3} },{  0.578125, {37,  3} },{  0.609375, {39,  3} },
    {  0.640625, {41,  3} },{  0.671875, {43,  3} },{  0.703125, {45,  3} },{  0.734375, {47,  3} },
    {  0.765625, {49,  3} },{  0.796875, {51,  3} },{  0.828125, {53,  3} },{  0.859375, {55,  3} },
    {  0.890625, {57,  3} },{  0.921875, {59,  3} },{  0.953125, {61,  3} },{  0.984375, {63,  3} }

};


#endif
